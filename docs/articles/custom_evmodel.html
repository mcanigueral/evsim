<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Custom evmodel • evsim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Custom evmodel">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-J2NB3LGNZN"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-J2NB3LGNZN');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">evsim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/evsim.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/time_resolution.html">Time resolution</a></li>
    <li><a class="dropdown-item" href="../articles/multi_processing.html">Multi-core processing</a></li>
    <li><a class="dropdown-item" href="../articles/custom_evmodel.html">Custom evmodel</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mcanigueral/evsim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Custom evmodel</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mcanigueral/evsim/blob/HEAD/vignettes/custom_evmodel.Rmd" class="external-link"><code>vignettes/custom_evmodel.Rmd</code></a></small>
      <div class="d-none name"><code>custom_evmodel.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="simplifying-our-model">Simplifying our model<a class="anchor" aria-label="anchor" href="#simplifying-our-model"></a>
</h2>
<p>The <code>evmodel</code> object obtained with <code>evprof</code>
contains all statistic parameters of the Gaussian Mixture Models for
both connection and energy models (see <a href="https://mcanigueral.github.io/evprof/articles/evmodel.html" class="external-link">this
article</a>). However, these GMM can be quite complex with a lot of
clusters (mixtures) and the JSON file describing the model can result in
a large file.</p>
<p>To check the complexity of the models and describe all parameters
within the JSON file, the function <code>get_evmodel_parameters</code>
provides the model parameters in a <code>list</code> form:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ev_model</span> <span class="op">&lt;-</span> <span class="fu">evsim</span><span class="fu">::</span><span class="va"><a href="../reference/california_ev_model.html">california_ev_model</a></span></span>
<span><span class="fu"><a href="../reference/get_evmodel_parameters.html">get_evmodel_parameters</a></span><span class="op">(</span><span class="va">ev_model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $Workday</span></span>
<span><span class="co">## $Workday$Visit</span></span>
<span><span class="co">## $Workday$Visit$ratio</span></span>
<span><span class="co">## [1] 0.4603</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Workday$Visit$connection_models</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">##   start_mean start_sd duration_mean duration_sd ratio</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>      12.2      1.01          4.73        1.09 0.235</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>       7.44     1.04          4.66        1.23 0.446</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>      15.3      1.01          2.45        1.25 0.319</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Workday$Visit$energy_models</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">##   charging_rate energy_mean energy_sd ratio</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Unknown              11.8      1.18     1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Workday$Worktime</span></span>
<span><span class="co">## $Workday$Worktime$ratio</span></span>
<span><span class="co">## [1] 0.5397</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Workday$Worktime$connection_models</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">##   start_mean start_sd duration_mean duration_sd ratio</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>       7.31     1.00          9.75        1.01 0.305</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>       7.31     1.03          8.90        1.03 0.428</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>       6.55     1.01          9.64        1.00 0.267</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Workday$Worktime$energy_models</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">##   charging_rate energy_mean energy_sd ratio</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Unknown              16.1      1.14     1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Weekend</span></span>
<span><span class="co">## $Weekend$Visit</span></span>
<span><span class="co">## $Weekend$Visit$ratio</span></span>
<span><span class="co">## [1] 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Weekend$Visit$connection_models</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">##   start_mean start_sd duration_mean duration_sd ratio</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>       7.54     1.01          7.23        1.07 0.205</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>      11.3      1.06          3.55        1.30 0.795</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Weekend$Visit$energy_models</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">##   charging_rate energy_mean energy_sd ratio</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Unknown              13.3      1.49     1</span></span></code></pre>
<p>Even though the California EV model doesn’t have a lot of clusters
the composition of the model is complex enough, and the logarithmic
scale makes it difficult to interpret. Therefore, the <code>evsim</code>
package also provides a function to simplify the clusters calculating
the average connection and energy pattern for every user profile,
converting the logarithmic values to the natural scale:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_evmodel_summary.html">get_evmodel_summary</a></span><span class="op">(</span><span class="va">ev_model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $Workday</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 8</span></span></span>
<span><span class="co">##   profile  ratio start_mean start_sd duration_mean duration_sd energy_mean</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Visit    0.460      11.1      1.02          3.97        1.20        11.8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Worktime 0.540       7.11     1.02          9.36        1.02        16.1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: energy_sd &lt;dbl&gt;</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Weekend</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 8</span></span></span>
<span><span class="co">##   profile ratio start_mean start_sd duration_mean duration_sd energy_mean</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Visit       1       10.5     1.05          4.30        1.25        13.3</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: energy_sd &lt;dbl&gt;</span></span></span></code></pre>
<p>Now we can see that every time-cycle is defined by a simple user
profile with an average behaviour. This format is also useful to save
the model in Excel, since it can be saved directly in an Excel file
where every time-cycle will be a different worksheet:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_evmodel_summary.html">get_evmodel_summary</a></span><span class="op">(</span><span class="va">ev_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">writexl</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/writexl//reference/write_xlsx.html" class="external-link">write_xlsx</a></span><span class="op">(</span><span class="st">"ev_model.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="designing-a-custom-model">Designing a custom model<a class="anchor" aria-label="anchor" href="#designing-a-custom-model"></a>
</h2>
<p>Moreover, sometimes maybe it is desired to build a custom model with
specific average connection start time and duration and average energy
charged. In this case, the Excel file created with the previous command
can be used as a template to define our custom user profiles and
parameters. After editing the file we can read it again:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom_model</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/excel_sheets.html" class="external-link">excel_sheets</a></span><span class="op">(</span><span class="st">"ev_model_custom.xlsx"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="op">~</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span><span class="st">"ev_model_custom.xlsx"</span>, sheet <span class="op">=</span> <span class="va">.x</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then, these parameters can be passed to argument
<code>parameters_lst</code> of function
<code><a href="../reference/get_custom_ev_model.html">evsim::get_custom_ev_model</a></code>, where every element of this
list must be a different time-cycle (as our object
<code>custom_model</code> is). In the
<code><a href="../reference/get_custom_ev_model.html">evsim::get_custom_ev_model</a></code> function also the months and
weekdays corresponding to every time-cycle (worksheet in the Excel file)
and the time-zone of the use case must be configured in parameters
<code>months_lst</code>, <code>wdays_lst</code> and
<code>data_tz</code>, respectively. Finally, <code>connection_log</code>
and <code>energy_log</code> parameters may be always <code>FALSE</code>
since it is assumed that a custom model is built in the natural
scale:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evmodel_custom</span> <span class="op">&lt;-</span> <span class="fu">evsim</span><span class="fu">::</span><span class="fu"><a href="../reference/get_custom_ev_model.html">get_custom_ev_model</a></span><span class="op">(</span></span>
<span>  names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">custom_model</span><span class="op">)</span>,</span>
<span>  months_lst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>  wdays_lst <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>,</span>
<span>  parameters_lst <span class="op">=</span> <span class="va">custom_model</span>,</span>
<span>  connection_log <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  energy_log <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  data_tz <span class="op">=</span> <span class="st">"America/Los_Angeles"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marc Cañigueral.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
